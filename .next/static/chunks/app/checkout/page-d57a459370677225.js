(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{1405:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>f});var a=t(5155),r=t(2115),l=t(2619),i=t.n(l),n=t(63),d=t(2529),c=t(5626);let o=(0,t(1847).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var u=t(5947),m=t(1152),x=t(1559),h=t(3875),p=t(6262),y=t(8406),b=t(277),g=t(4659),j=t(2663);function f(){let e=(0,n.useRouter)(),{items:s,subtotal:t,delivery:l,clearCart:f}=(0,p.x)(),{user:v,isAuthenticated:N}=(0,y.n)(),[k,_]=(0,r.useState)(N?"address":"choice"),[w,P]=(0,r.useState)(!1),[C,A]=(0,r.useState)(""),[S,q]=(0,r.useState)(""),[I,z]=(0,r.useState)(""),[O,D]=(0,r.useState)(""),[R,M]=(0,r.useState)("Nairobi"),[W,E]=(0,r.useState)(""),[L,T]=(0,r.useState)(""),[K,F]=(0,r.useState)(""),[G,Y]=(0,r.useState)("idle"),B=1500*!!l,H=t+B,Q=e=>{"guest"===e?_("guest-form"):_("login")},V=async e=>(e.preventDefault(),S&&I)?(0,g.g0)(I)?void _("address"):void j.oR.error("Invalid phone number"):void j.oR.error("Please fill in all fields"),Z=async e=>(e.preventDefault(),O&&W&&L)?(0,g.g0)(L)?void _("payment"):void j.oR.error("Invalid phone number"):void j.oR.error("Please fill in all address fields"),J=async e=>{if(e.preventDefault(),!K)return void j.oR.error("Please enter M-Pesa phone number");if(!(0,g.g0)(K))return void j.oR.error("Invalid phone number");Y("processing"),P(!0);try{let e={items:s.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price})),guest_email:S||(null==v?void 0:v.email),guest_phone:(0,g.h2)(I||L),delivery_address:O,delivery_city:R,delivery_method:l||"standard",subtotal:t,delivery_fee:B,total:H},a=await b.PI.checkout(e);await b.PI.initiateSTKPush({order_id:a.data.id,phone_number:(0,g.h2)(K)}),A(a.data.order_number||"ORD-"+Date.now()),Y("success"),_("success"),f(),j.oR.success("Order placed successfully!")}catch(e){Y("error"),(0,b.hS)(e),j.oR.error("Failed to process payment")}finally{P(!1)}};return"success"===k?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-success-green to-success-green/50 pb-20 md:pb-0 flex items-center justify-center p-4",children:(0,a.jsx)(u.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:30},className:"max-w-md w-full",children:(0,a.jsxs)(h.A,{className:"text-center p-8 space-y-6",children:[(0,a.jsx)(u.P.div,{animate:{rotate:[0,10,-10,0]},transition:{delay:.3,duration:.6},children:(0,a.jsx)(d.A,{className:"h-20 w-20 text-success-green mx-auto"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-road-grey-900 mb-2",children:"Order Confirmed!"}),(0,a.jsx)("p",{className:"text-road-grey-600",children:"Thank you for your purchase"})]}),(0,a.jsxs)("div",{className:"bg-road-grey-50 rounded-lg p-4 space-y-2",children:[(0,a.jsx)("p",{className:"text-sm text-road-grey-600",children:"Order Number"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-road-grey-900 font-mono",children:C})]}),(0,a.jsxs)("div",{className:"space-y-2 text-left text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-road-grey-600",children:"Items:"}),(0,a.jsx)("span",{className:"font-semibold",children:s.length})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-road-grey-600",children:"Total Paid:"}),(0,a.jsx)("span",{className:"font-semibold",children:(0,g.gh)(H)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-road-grey-600",children:"Delivery:"}),(0,a.jsx)("span",{className:"font-semibold",children:"Nairobi 1-2 Days"})]})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-mechanic-blue/20 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-sm text-road-grey-700",children:[(0,a.jsx)("strong",{children:"What's next?"})," You'll receive a confirmation message shortly with tracking details."]})}),(0,a.jsxs)("div",{className:"space-y-3 pt-4",children:[(0,a.jsx)(i(),{href:"/",className:"block",children:(0,a.jsx)(x.A,{variant:"primary",fullWidth:!0,size:"lg",children:"Continue Shopping"})}),(0,a.jsx)(i(),{href:"/profile?tab=orders",className:"block",children:(0,a.jsx)(x.A,{variant:"secondary",fullWidth:!0,size:"lg",children:"View Orders"})})]})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-road-grey-100 pb-20 md:pb-0",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-4",children:[(0,a.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center gap-2 text-mechanic-blue hover:text-mechanic-blue/80 mb-6 transition-colors",children:[(0,a.jsx)(c.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-semibold",children:"Back"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsxs)(m.N,{mode:"wait",children:["choice"===k&&(0,a.jsxs)(u.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-road-grey-900",children:"Check Out"}),(0,a.jsx)("p",{className:"text-road-grey-600 mb-6",children:"No account needed - checkout fast. Create one later to track orders & save vehicles."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(x.A,{variant:"primary",size:"lg",fullWidth:!0,onClick:()=>Q("guest"),children:"Continue as Guest"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"w-full border-t border-road-grey-300"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,a.jsx)("span",{className:"px-2 bg-road-grey-100 text-road-grey-600",children:"Or"})})]}),(0,a.jsx)(x.A,{variant:"secondary",size:"lg",fullWidth:!0,onClick:()=>Q("login"),children:"Log In / Create Account"})]})]},"choice"),"guest-form"===k&&(0,a.jsxs)(u.P.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},onSubmit:V,className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-road-grey-900",children:"Your Contact Info"}),(0,a.jsxs)(h.A,{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-road-grey-900 mb-2",children:"Email Address"}),(0,a.jsx)("input",{type:"email",value:S,onChange:e=>q(e.target.value),placeholder:"your@email.com",className:"w-full px-4 py-3 border border-road-grey-300 rounded-lg focus:border-mechanic-blue focus:outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-road-grey-900 mb-2",children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",value:I,onChange:e=>z(e.target.value),placeholder:"0722123456",className:"w-full px-4 py-3 border border-road-grey-300 rounded-lg focus:border-mechanic-blue focus:outline-none",required:!0}),(0,a.jsx)("p",{className:"text-xs text-road-grey-600 mt-2",children:"Kenyan format: 0722123456"})]})]}),(0,a.jsx)(x.A,{variant:"primary",size:"lg",fullWidth:!0,type:"submit",children:"Continue"})]},"guest-form"),"address"===k&&(0,a.jsxs)(u.P.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},onSubmit:Z,className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-road-grey-900",children:"Delivery Address"}),(0,a.jsxs)(h.A,{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-road-grey-900 mb-2",children:"Recipient Name"}),(0,a.jsx)("input",{type:"text",value:W,onChange:e=>E(e.target.value),placeholder:"Full name",className:"w-full px-4 py-3 border border-road-grey-300 rounded-lg focus:border-mechanic-blue focus:outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-road-grey-900 mb-2",children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",value:L,onChange:e=>T(e.target.value),placeholder:"0722123456",className:"w-full px-4 py-3 border border-road-grey-300 rounded-lg focus:border-mechanic-blue focus:outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-road-grey-900 mb-2",children:"Delivery Address"}),(0,a.jsx)("textarea",{value:O,onChange:e=>D(e.target.value),placeholder:"Street address, building name, apartment number, etc.",className:"w-full px-4 py-3 border border-road-grey-300 rounded-lg focus:border-mechanic-blue focus:outline-none resize-none",rows:4,required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-road-grey-900 mb-2",children:"City"}),(0,a.jsxs)("select",{value:R,onChange:e=>M(e.target.value),className:"w-full px-4 py-3 border border-road-grey-300 rounded-lg focus:border-mechanic-blue focus:outline-none",children:[(0,a.jsx)("option",{value:"Nairobi",children:"Nairobi"}),(0,a.jsx)("option",{value:"Mombasa",children:"Mombasa"}),(0,a.jsx)("option",{value:"Kisumu",children:"Kisumu"}),(0,a.jsx)("option",{value:"Eldoret",children:"Eldoret"}),(0,a.jsx)("option",{value:"Nakuru",children:"Nakuru"}),(0,a.jsx)("option",{value:"Other",children:"Other"})]})]})]}),(0,a.jsx)(x.A,{variant:"primary",size:"lg",fullWidth:!0,type:"submit",children:"Continue to Payment"})]},"address"),"payment"===k&&(0,a.jsxs)(u.P.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},onSubmit:J,className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-road-grey-900",children:"Payment"}),"error"===G&&(0,a.jsxs)("div",{className:"bg-red-50 border border-reliable-red/20 rounded-lg p-4 flex gap-4",children:[(0,a.jsx)(o,{className:"h-5 w-5 text-reliable-red flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-reliable-red",children:"Payment Failed"}),(0,a.jsx)("p",{className:"text-sm text-road-grey-600 mt-1",children:"Please check your M-Pesa balance and try again"})]})]}),(0,a.jsx)(h.A,{className:"p-6 space-y-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-road-grey-900 mb-4",children:"M-Pesa Payment"}),(0,a.jsx)("label",{className:"block text-sm font-bold text-road-grey-900 mb-2",children:"M-Pesa Phone Number"}),(0,a.jsx)("input",{type:"tel",value:K,onChange:e=>F(e.target.value),placeholder:"0722123456",className:"w-full px-4 py-3 border border-road-grey-300 rounded-lg focus:border-mechanic-blue focus:outline-none",required:!0,disabled:w}),(0,a.jsx)("p",{className:"text-xs text-road-grey-600 mt-2",children:"You'll receive an M-Pesa prompt to enter your PIN"})]})}),(0,a.jsx)(x.A,{variant:"primary",size:"lg",fullWidth:!0,type:"submit",isLoading:w,disabled:"processing"===G,children:"processing"===G?"Processing...":"Pay ".concat((0,g.gh)(H))})]},"payment"),"login"===k&&(0,a.jsxs)(u.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-road-grey-600 mb-6",children:"Login to your account or create a new one"}),(0,a.jsx)(i(),{href:"/auth/login?redirect=/checkout",className:"block mb-4",children:(0,a.jsx)(x.A,{variant:"primary",size:"lg",fullWidth:!0,children:"Go to Login"})}),(0,a.jsx)("button",{onClick:()=>_("choice"),className:"text-mechanic-blue hover:text-mechanic-blue/80 font-semibold transition-colors",children:"Prefer to continue as guest?"})]},"login")]})}),(0,a.jsx)("div",{className:"h-fit",children:(0,a.jsxs)(h.A,{className:"p-6 space-y-4 sticky top-6",children:[(0,a.jsx)("h3",{className:"font-bold text-lg text-road-grey-900",children:"Order Summary"}),(0,a.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:s.map(e=>(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-road-grey-600",children:[e.product_name," x",e.quantity]}),(0,a.jsx)("span",{className:"font-semibold",children:(0,g.gh)(e.unit_price*e.quantity)})]},e.product_id))}),(0,a.jsxs)("div",{className:"border-t border-road-grey-200 pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-road-grey-600",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsx)("span",{children:(0,g.gh)(t)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-road-grey-600",children:[(0,a.jsx)("span",{children:"Delivery"}),(0,a.jsx)("span",{children:(0,g.gh)(B)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold text-road-grey-900",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsx)("span",{className:"text-reliable-red",children:(0,g.gh)(H)})]})]})]})})]})]})})}},2529:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(1847).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4478:(e,s,t)=>{Promise.resolve().then(t.bind(t,1405))},5626:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(1847).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6262:(e,s,t)=>{"use strict";t.d(s,{x:()=>i});var a=t(5988),r=t(9863);let l=(e,s)=>{let t=e.reduce((e,s)=>e+s.unit_price*s.quantity,0);return{subtotal:t,total:t+((null==s?void 0:s.delivery_cost)||0)}},i=(0,a.vt)()((0,r.Zr)((e,s)=>({items:[],delivery:null,guest_email:null,guest_phone:null,subtotal:0,total:0,addItem:s=>{e(e=>{let t,{subtotal:a,total:r}=l(t=e.items.find(e=>e.product_id===s.product_id)?e.items.map(e=>e.product_id===s.product_id?{...e,quantity:e.quantity+s.quantity}:e):[...e.items,s],e.delivery);return{items:t,subtotal:a,total:r}})},removeItem:s=>{e(e=>{let t=e.items.filter(e=>e.product_id!==s),{subtotal:a,total:r}=l(t,e.delivery);return{items:t,subtotal:a,total:r}})},updateQuantity:(t,a)=>{e(e=>{if(a<=0)return s().removeItem(t),e;let r=e.items.map(e=>e.product_id===t?{...e,quantity:a}:e),{subtotal:i,total:n}=l(r,e.delivery);return{items:r,subtotal:i,total:n}})},clearCart:()=>{e({items:[],delivery:null,guest_email:null,guest_phone:null})},setDelivery:s=>{e(e=>{let{subtotal:t,total:a}=l(e.items,s);return{delivery:s,subtotal:t,total:a}})},setGuestInfo:(s,t)=>{e({guest_email:s,guest_phone:t})},getCartCount:()=>s().items.reduce((e,s)=>e+s.quantity,0),calculateTotals:()=>{let t=s(),{subtotal:a,total:r}=l(t.items,t.delivery);e({subtotal:a,total:r})}}),{name:"autoparts-cart",partialize:e=>({items:e.items,delivery:e.delivery,guest_email:e.guest_email,guest_phone:e.guest_phone,subtotal:e.subtotal,total:e.total})}))}},e=>{e.O(0,[619,8,663,44,947,61,623,358],()=>e(e.s=4478)),_N_E=e.O()}]);